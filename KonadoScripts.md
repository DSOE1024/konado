# Konado Scripts 文档


## 文件结构

- 文件扩展名：`.ks`（可通过配置允许自定义后缀）
- 编码：UTF-8
- 元数据：必须位于文件首行

## 元数据语法

### shot_id
```
shot_id <镜头标识符>
```
- 必须位于文件第一行
- 用于唯一标识一个对话镜头

示例：
```
shot_id opening_scene
```

## 内容语法

### 1. 注释
```
## 注释内容
```
- 以`##`开头的单行注释


### 2. 背景切换
```
background <背景图片名称> [效果类型]
```
- 效果类型可选：erase, blinds, wave, fade

示例：
```
background forest_bg fade
```

### 3. 角色控制

#### 显示角色
```
actor show <角色名称> <角色状态> at <x坐标> <y坐标> scale <缩放比例> [mirror]
```
- mirror为可选参数，表示镜像显示角色

示例：
```
actor show alice happy at 300 400 scale 1.0
```

#### 退出角色
```
actor exit <角色名称>
```

#### 改变角色状态
```
actor change <角色名称> <新状态>
```

#### 移动角色
```
actor move <角色名称> <目标x坐标> <目标y坐标>
```

### 4. 音频控制

#### 播放BGM
```
play bgm <BGM名称>
```

#### 播放音效
```
play sfx <音效名称>
```

#### 停止BGM
```
stop bgm
```

### 5. 选项分支
```
choice "选项文本1" <跳转标签1> "选项文本2" <跳转标签2> ...
```
- 选项文本需用引号包围
- 选项数量和跳转标签必须成对出现

示例：
```
choice "进入森林" forest_path "留在村庄" village_stay
```

### 6. 分支标签
```
branch <分支标签名称>
    缩进的内容行
```
- 分支内容必须缩进（4个空格或制表符）
- 分支内可包含其他语法元素
- 分支内不能嵌套其他分支

示例：
```
branch forest_path
    "导游" "我们决定进入森林探索..."
    background forest_interior
```

### 7. 镜头跳转
```
jump <目标镜头id>
```

### 8. 对话行
```
"角色ID" "对话内容" [语音ID]
```
- 语音ID为可选参数

示例：
```
"alice" "你好，欢迎来到我们的世界!" alice_greeting
```

### 9. 特殊标记

#### 开始标记
```
start
```

#### 结束标记
```
end
```

## 语法规则

1. 空行和只有空白字符的行会被忽略，尽可能不要出现空白字符
2. 缩进的行被视为分支标签的内容，如果在该行前没有对应的分支标签，则默认跳过
3. 所有语法元素区分大小写
4. 字符串参数需用双引号包围
5. 跳转标签必须在文件中存在对应的分支标签

## 配置选项

解释器支持以下配置选项：

- `allow_custom_suffix`: 是否允许自定义文件后缀（默认为false）
- `allow_skip_error_line`: 是否允许跳过错误行（默认为false）
- `enable_actor_validation`: 是否启用角色验证（默认为true）

